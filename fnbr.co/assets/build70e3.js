$(document).ready(function(){$('.card-body.api').length&&$('button[data-action="regenerate-key"]').off('click').on('click',function(t){t.preventDefault();$(this).attr('disabled','disabled');$('#api-error').stop().slideUp(200);$.ajax({url:'/api/regenerate-key',type:'post',data:{_csrf:$('meta[name="csrf-token"]').attr('content')},timeout:5e3,async:!0,success:function(t){$('button[data-action="regenerate-key"]').removeAttr('disabled');t.status==200?($('.api-key-box').length?$('.api-key-text').text(t.key):window.location.reload()):$('#api-error').stop().html('<strong>Error:</strong> '+t.error).slideDown(450)},error:function(t,e,a){$('button[data-action="regenerate-key"]').removeAttr('disabled');$('#api-error').stop().html('<strong>Error:</strong> An error occured while processing that request!').slideDown(450)}});return!1});$('.deadline').length});$(document).ready(function(){$('table#cosmetics').length&&$('table#cosmetics').tablesorter();$('#popular-count').length&&$('#popular-count').html($('#popular-count').html().toString().replace(/\B(?=(\d{3})+(?!\d))/g,','));if($('.row.items.all').length){var t,e,a=function(a){try{t.abort()}catch(t){};clearTimeout(e);$('.loading-more').stop().fadeIn(250);e=setTimeout(function(){$('.loading-more p.too-long').stop().slideDown(600)},3e3);t=$.ajax({url:'/chunk/'+a,async:!0,timeout:7500,success:function(a,n,i){clearTimeout(e);$('.row.items.all').attr('data-last',i.getResponseHeader('x-final-chunk'));$(a).appendTo('.row.items.all');t=!1;o();typeof $.lazy!='undefined'&&($('.lazy').length>=30?$('.lazy').lazy({effect:'fadeIn',effectTime:250,threshold:200}):$('.lazy').lazy())},error:function(t,a,n){clearTimeout(e);console.log(t,a,n);if(n==''||n=='Not Found'){$('.loading-more').stop().slideUp(200);return}a=='timeout'?($('.loading-more p.too-long').stop().fadeOut(200),$('.loading-more span').stop().slideUp(200,function(){$('.loading-more p.load-err').stop().html('The request timed out.<br><small>Please refresh the page and try again.</small>').fadeIn(250)})):($('.loading-more p.too-long').stop().fadeOut(200),$('.loading-more span').stop().slideUp(200,function(){$('.loading-more p.load-err').stop().html('An error occured<br><small>Please refresh the page and try again.</small>').fadeIn(250)}))}})};$(window).scroll(function(){if($(window).scrollTop()>=$(document).height()-$(window).height()-700){if(t){return}a($('.row.items.all').attr('data-last'))}})}if($('input[name="cosmeticSearchBox"]').length){var n=$('table#cosmetics tbody tr').length?!0:!1,i=function(t){n?$('table#cosmetics tbody tr').filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(t)>-1)}):($('.items.all .col').filter(function(){if(!$(this).find('.splash-card')||!$(this).find('.splash-card').is('[data-name]')){return}$(this).toggle($(this).find('.splash-card').attr('data-name').toLowerCase().indexOf(t)>-1)}),$('.items.all .col:visible').length>0?$('.items.all .none').hide():$('.items.all .none').show());$(window).trigger('scroll')};$('input[name="cosmeticSearchBox"]').off('keyup paste blur').on('keyup',function(t){i($(this).val().toLowerCase())}).on('paste',function(t){i($(this).val().toLowerCase())}).on('blur',function(t){i($(this).val().toLowerCase())})}var o=function(){if($('.splash-card').length){var t=$('.mobile-helper').is(':visible');$('.splash-card').each(function(e,a){var n=$(a).find('.itemname'),i=n.text().length;t?(i>=18&&n.addClass('marquee')):(i>=18&&n.text()!='Alpine Accessories'&&n.addClass('marquee'))})}};o();typeof $.lazy!='undefined'?($('.lazy').length>=30?$('.lazy').lazy({effect:'fadeIn',effectTime:250,threshold:200}):$('.lazy').lazy()):console.info('lazy js not found, not lazy loading any content');checkDate();window.location.pathname=='/privacy'&&$('.alert[data-alert="privacy"]').hide()});var checkDate=function(){if(window.location.pathname=='/shop'){return}var t=15,e=new Date($('meta[name="today-date"]').attr('content')),a=new Date,n=new Date;n.setUTCHours(0,0,0,0);a.setDate(a.getDate()+1);a.setUTCHours(0,0,0,0);var i=a-e,o=n-e;(i<=t*60*1e3||o>=-(t*60*1e3))&&$('.alert-notice[data-alert="reset"]').show()};$(function(){if($('body.cube').length){var t=function(t){$('body.cube .time').html((t.hours>0?this.leadingZeros(t.hours):0)+'h '+this.leadingZeros(t.min)+'m '+this.leadingZeros(t.sec>=60?0:t.sec)+'s')},e=function(){i=Date.now()-a;o=Math.floor(i/n);r=a+(o+1)*n;this.restart({date:new Date(r),render:t,onEnd:e})},a=1535397418000,n=6171480,i=Date.now()-a,o=Math.floor(i/n),r=a+(o+1)*n;$('body.cube .time').countdown({date:new Date(r),render:t,onEnd:e})}});$(document).ready(function(){$('.filter-button').click(function(){var t=$(this).attr('data-filter');t=='all'?$('.filter').stop().show('1000'):($('.filter').not('.'+t).stop().hide('3000'),$('.filter').filter('.'+t).stop().show('3000'));$(window).trigger('scroll')});$('.filter-button').removeClass('active')&&($(this).removeClass('active'),$(window).trigger('scroll'));$(this).addClass('active');if($('.shop-rotation').length){var t=$('meta[name="today-date"]').attr('content'),e=new Date(t);e.setDate(e.getDate()+1);e.setUTCHours(0,0,0);$('.shop-rotation .countdown').countdown({date:e,render:function(t){var e='';t.hours>6?(e=t.hours+' hour'+(t.hours==1?'':'s')):(e=(t.hours>=1?t.hours+':':'')+this.leadingZeros(t.min)+':'+this.leadingZeros(t.sec>=60?0:t.sec));$('.shop-rotation .countdown').text(e)},onEnd:function(){console.info('Countdown finished, refreshing tab');$('.shop-rotation .countdown-badge').fadeOut(400);setTimeout(function(){window.location.reload()},5e3)}})}$('.history-featured').length&&$('.history-featured').slick({infinite:!0,slidesToShow:2,slidesToScroll:1});$('.history-daily').length&&$('.history-daily').slick({infinite:!0,slidesToShow:4,slidesToScroll:1})});$(function(){if($('.item-container').length){var t=function(t){var e=t&&typeof t=='number'?t:parseFloat($('.item-side .rating').attr('data-rating'));t=t&&typeof t=='number'?t:parseInt($('.item-side .rating').attr('data-rating'));var a=e-Math.floor(e);$('.item-side .rating .star').filter(function(){return parseInt($(this).attr('data-star'))>t}).removeClass('active');$('.item-side .rating .star').filter(function(){var e=parseInt($(this).attr('data-star'));return e<=t||a>=.75&&e-1==t}).addClass('active');$('.item-side .rating').removeClass('pending')};t();var e,a=!1,n=function(t){clearTimeout(e);$('.rate-message').stop().removeClass('shake animated');e=setTimeout(function(){$('.rate-message').html(t).addClass('animated shake').fadeIn(250);e=setTimeout(function(){$('.rate-message').stop().slideUp(250).removeClass('shake animated')},5e3)},50)};$('.item-side .rating .star').off('mouseenter mouseleave').on('mouseenter',function(e){if(a||$('.item-side .rating').hasClass('disabled')){return}var n=parseInt($(this).attr('data-star'));t(n);$('.item-side .rating .text .source').hide();$('.item-side .rating .text .temporary').show().html('Click to rate '+n+' star'+(n==1?'':'s')+'<br>&nbsp;')}).on('mouseleave',function(e){if(a||$('.item-side .rating').hasClass('disabled')){return}t();$('.item-side .rating .text .source').show();$('.item-side .rating .text .temporary').hide().text('')}).on('click',function(e){e.preventDefault();if(a||$('.item-side .rating').hasClass('disabled')){return}if(!$('#userDropdown').length&&!$('#apiDropdown').length){n('You must be <a href="/oauth">logged in</a> to rate items');return!1}try{a.abort()}catch(t){};$('.item-side .rating').addClass('pending');$('.item-side .rating .text .temporary').show().html('Rating item '+parseInt($(this).attr('data-star'))+' star'+(parseInt($(this).attr('data-star'))==1?'':'s')+'<br>Please wait&hellip;');a=$.ajax({type:'post',data:{_csrf:$('meta[name="csrf-token"]').attr('content'),_id:$(this).closest('.item-container').attr('data-id'),rating:parseInt($(this).attr('data-star'))},dataType:'json',timeout:5e3,url:'/api/rating',success:function(e){e.status==200?($('.item-side .rating').removeClass('pending').addClass('disabled'),$('.item-side .rating .text .source').show(),$('.item-side .rating .text .temporary').hide().text(''),$('.item-container .item-side .rating').attr('data-rating',(e.totalRating?e.totalRating:e.userRating)),e.totalRating?$('.item-container .item-side .rating .source').html('Rated: '+parseFloat(e.totalRating).toFixed(2)+'/5<br>From '+e.totalVotes+' vote'+(e.totalVotes==1?'':'s')):$('.item-container .item-side .rating .source').html(''),$('.item-container .item-side .your-rate').html('Your rating: '+(e.userRating==1?' 1 star':e.userRating+' stars')).slideDown(300),a=!1):(a=!1,t(),n(e.error))},error:function(e,i,o){a=!1;t();n((o=='Too Many Requests'?'Please wait before rating an item again':'Rating failed, an error occured'));$('.item-side .rating .text .source').show();$('.item-side .rating .text .temporary').hide().text('')}});return!1})}$('.rating-holder').length&&($('.rating').each(function(){var t=$(this),e=parseInt(t.attr('data-rating'));$(this).find('.star').filter(function(){return parseInt($(this).attr('data-star'))>e}).removeClass('active');$(this).find('.star').filter(function(){return parseInt($(this).attr('data-star'))<=e}).addClass('active')}),typeof moment!==void 0&&$('[moment-date]').each(function(t,e){var a=new Date($(e).attr('moment-date'));$(e).attr('title',moment(a).format('MMMM Do YYYY'));$(e).text(moment(a).fromNow())}))});NavController={menuTimeout:!1,visible:!0,inTransit:!1,updateActiveLink:function(){var t=$('nav.side .primary-navigation').attr('data-active-page');$('nav.side .primary-navigation').children('a').each(function(){var e=$(this);(e.attr('href').substring(1)==t||e[0].hasAttribute('data-ajax')&&e.attr('data-ajax')==t||e.attr('href')=='/'&&t=='dashboard')&&e.addClass('active')})},needOverlay:function(){return window.innerWidth<=992},handleResize:function(){window.innerWidth>992?($('#nav-overlay').length&&NavController.visible?NavController.hideMenu():NavController.showMenu()):NavController.hideMenu()},showMenu:function(){clearTimeout(this.menuTimeout);NavController.inTransit=!0;NavController.visible=!0;$('.flex-wrap-item[data-type="side-nav"]').removeClass('overlap');$('.flex-wrap-item[data-type="side-nav"]').css('flex-basis','').css('flex-grow','');$('.flex-wrap-item[data-type="main"]').removeClass('solo');if(this.needOverlay()){var t=$('body');$('#nav-overlay').remove();var e=$('<div id="nav-overlay"></div>'),a=t.innerWidth();t.css('overflow','hidden');t.width(a);e.click(function(){NavController.hideMenu()});$('body').append(e);$('.flex-wrap-item[data-type="side-nav"]').addClass('overlap')}this.menuTimeout=setTimeout(function(){$('.flex-wrap-item[data-type="side-nav"]').css('display','');NavController.needOverlay()&&$('#nav-overlay').css('opacity','1');NavController.inTransit=!1},10)},hideMenu:function(){clearTimeout(this.menuTimeout);NavController.inTransit=!0;$('.flex-wrap-item[data-type="side-nav"]').css('flex-basis','0px').css('flex-grow','0');$('.flex-wrap-item[data-type="main"]').addClass('solo');$('#nav-overlay').length&&$('#nav-overlay').stop().css('opacity',0);$('body').css({overflow:'',width:''});this.menuTimeout=setTimeout(function(){NavController.inTransit=!1;NavController.visible=!1;$('#nav-overlay').remove();$('.flex-wrap-item[data-type="side-nav"]').removeClass('overlap')},200)},cancel:function(){clearTimeout(this.menuTimeout);NavController.inTransit=!1}};NavController.handleResize();NavController.updateActiveLink();$(window).resize(function(){NavController.handleResize()});$('.nav-toggle').off('click').on('click',function(){NavController.visible||$('.flex-wrap-item[data-type="side-nav"]').css('width')!='0px'?NavController.hideMenu():NavController.showMenu()});$(document).ready(function(){$('.news-holder').length&&$('button[data-action="load-news"]').length&&$('button[data-action="load-news"]').off('click').on('click',function(t){t.preventDefault();$(this).attr('disabled','disabled').text('Loading...');$.ajax({url:'/news/ajax',type:'post',data:{_csrf:$('meta[name="csrf-token"]').attr('content'),after:$('.news-item:last-child').attr('data-id')||!1},success:function(t){if(t.status==200&&t.items.length>0){for(var e=0;e<t.items.length;e++){var a=t.items[e],n=`
                            <div class="card mt-4 news-item" data-id="${a._id}">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-3 media-img">
                                            <img class="img-responsive lazy" data-src="${a.image}">
                                        </div>

                                        <div class="col-md-9 media-text">
                                            <h4 class="card-title mt-2">${a.title}</h4>
                                            <p class="card-text">${a.body}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>`;$('.news-holder').append(n)}$('.lazy').lazy({effect:'fadeIn',effectTime:250});$(window).trigger('scroll');t.complete?$('button[data-action="load-news"]').stop().slideUp(500,function(){$(this).remove()}):$('button[data-action="load-news"]').removeAttr('disabled').text('Load more')}else $('button[data-action="load-news"]').removeAttr('disabled').text('Load more')},error:function(t,e,a){$('button[data-action="load-news"]').removeAttr('disabled').text('Load More')}});return!1})});$(document).ready(function(){if($('.random-hold').length){var t=function(t){t.find('.card-img-top').off('load').on('load',function(){t.removeClass('picking')});var e=t.hasClass('picking');t.stop().addClass('picking');t.off('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend').on('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend',function(t){e=!0});var a=function(n){e?(t.removeClass('rarity-legendary rarity-rare rarity-epic rarity-uncommon rarity-common').addClass('rarity-'+n.item.rarity),t.find('.itemname').html(n.item.name),t.find('.itemprice').html((n.item.priceIconLink?'<img style="width:25px" src="'+n.item.priceIconLink+'">'+' ':'')+n.item.price),t.find('.card-img-top').attr('src',n.item.image),t.attr('data-current',n.item._id)):setTimeout(function(){a(n)},50)};$.ajax({url:'/api/random',type:'get',data:{type:t.attr('data-type'),now:t.attr('data-current')},async:!0,timeout:3e3,success:function(e){e.status==200?a(e):t.removeClass('picking')},error:function(e,a,n){t.removeClass('picking')}})};$('.random-hold button[data-action="randomise-all"]').off('click').on('click',function(e){e.preventDefault();t($('.random-hold .splash-card[data-type="outfit"]'));t($('.random-hold .splash-card[data-type="backpack"]'));t($('.random-hold .splash-card[data-type="pickaxe"]'));t($('.random-hold .splash-card[data-type="glider"]'));t($('.random-hold .splash-card[data-type="skydive"]'));t($('.random-hold .splash-card[data-type="loading"]'));return!1});$('.random-hold .splash-card').off('click').on('click',function(e){e.preventDefault();if($(this).hasClass('picking')){return!1}var a=$(this);t(a);return!1})}})